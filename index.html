<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Arkanoid game</title>

    <style>
        body {
            text-align: center;
            background: #333333;
        }

        canvas#game {
            background: rgba(70, 90, 140, 1);
            border: 1px #666666 solid;
        }
    </style>
    <!-- <script src="app.js"></script> -->
    <script type="module">
        import { Sprite } from './image.js';
        import { Ball } from './ball.js';
        import { Borders } from './borders.js';

        window.onload = async function () {
            var canvas = document.getElementById('game');
            if (!canvas.getContext) {
                alert('Canvas unsupported, bye!');

                return;
            }

            var ctx = canvas.getContext('2d');

            console.debug('Loading images...');

            var ballImage = new Sprite('/img/ball.png');
            var paddle = new Sprite('/img/paddle.png');
            
            // Wait to load all images
            await Promise.all([
                ballImage.load(),
                paddle.load()
            ]).then((a) => {
                console.log(a);
            });

            let ball = new Ball(ballImage);
            let borders = new Borders(0, 0, canvas.width, canvas.height)
            
            // window.requestAnimationFrame(draw);

            setInterval(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height); // clear canvas

                if (ball.checkColisions(borders)) {
                    // console.log('out');
                    // return;
                }

                ball.loop();
                ball.draw(ctx);

                paddle.draw(ctx, 104 / 2, 800 - 24);

            }, 1000 / 30)
        };
    </script>
</head>

<body>
    <canvas id="game" width="600" height="800">

    </canvas>
</body>

</html>