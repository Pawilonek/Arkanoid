<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Arkanoid game</title>

    <style>
        body {
            text-align: center;
            background: #333333;
        }

        canvas#game {
            background: rgba(70, 90, 140, 1);
            border: 1px #666666 solid;
        }
    </style>
    <!-- <script src="app.js"></script> -->
    <script type="module">
        import { Sprite } from './image.js';
        // import 'image.js';

        window.onload = async function () {
            var canvas = document.getElementById('game');
            if (!canvas.getContext) {
                alert('Canvas unsupported, bye!');

                return;
            }

            var ctx = canvas.getContext('2d');

            console.debug('Loading images...');

            var ball = new Sprite('/img/ball.png');
            var paddle = new Sprite('/img/paddle.png');

            // Wait to load all images
            await Promise.all([
                ball.load(),
                paddle.load()
            ]).then((a) => {
                console.log(a);
            });


            let ball_vx = canvas.width / 50;
            let ball_vy = canvas.height / 25;

            let ball_posx = 1;
            let ball_posy = 1;

            // window.requestAnimationFrame(draw);

            let board_x = canvas.width;
            let board_y = canvas.height;

            setInterval(function () {

                ctx.clearRect(0, 0, canvas.width, canvas.height); // clear canvas
                // ctx.fillStyle = 'rgba(70, 90, 140, 1)';
                // ctx.strokeStyle = 'rgba(0, 153, 255, 0.4)';
                // ctx.strokeStyle = 'rgba(0, 153, 255, 0.4)';

                if (ball_posx + ball_vx >= board_x) {
                    ball_vx *= -1;
                }
                if (ball_posx + ball_vx <= 0) {
                    ball_vx *= -1;
                }

                ball_posx += ball_vx;

                if (ball_posy + ball_vy >= board_y) {
                    ball_vy *= -1;
                }
                if (ball_posy + ball_vy <= 0) {
                    ball_vy *= -1;
                }

                ball_posy += ball_vy;

                ball.draw(ctx, ball_posx, ball_posy);
                paddle.draw(ctx, ball_posx - 104 / 2, 800 - 24)
                // ctx.drawImage(ball, ball_posx, ball_posy);
                // ctx.drawImage(paddle, );

            }, 1000 / 30)
        };
    </script>
</head>

<body>
    <canvas id="game" width="600" height="800">

    </canvas>
</body>

</html>